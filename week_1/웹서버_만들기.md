# 웹서버 만들기

## 네트워크 구축 - VPC, 서브넷, 인터넷 게이트웨이, 라우팅 테이블 생성

웹서버를 생성하기에 앞서 먼저 `네트워크를 구축`해보겠습니다.

네트워크를 구축한다는 것은 내가 인터넷 세상에서 살 공간을 마련한다는 것과 같습니다.   
우리는 AWS 계정을 생성해 AWS라는 인터넷 세상에 살게 되었습니다.   
그럼 VPC라는 `빌라`를 짓고, 서브넷이라는 `호`에 살게 됩니다.   
빌라의 현관에는 인터넷 게이트웨이라는 `문`을 달고, 라우터라는 `도어락`을 설치합니다.   

> <h3>VPC 생성</h3>

![image](https://user-images.githubusercontent.com/43658658/134436316-08f20892-152b-4420-a3a5-f7b7489bf7ef.png)

AWS 콘솔의 상단에 검색창에 `VPC`를 입력합니다.   
하단에 나타나는 항목 중 `VPC`를 클릭합니다.

![image](https://user-images.githubusercontent.com/43658658/134436441-9a7650f2-8451-40e5-a2ec-2b0140e22d1f.png)

왼쪽 탭에 [VPC]를 클릭하고, 우측에 [VPC 생성] 버튼을 클릭합니다.

![image](https://user-images.githubusercontent.com/43658658/134436767-8edcb86c-c34d-4288-852d-0c62960c67df.png)

`이름`과 `IPv4`를 입력합니다.   
`IPv4`는 VPC의 경우 `10.m.0.0/16`으로 입력해주시고, 이후의 서브넷의 경우 `10.m.n.0/24`로 입력해주세요.   
`테넌시`는 기본값과 전용이 있는데, 기본값은 인터넷망을 사용하는 것이고, 전용은 VPC 내에서만 사용하는 것입니다.

하단에 [VPC 생성] 버튼을 클릭합니다.

![image](https://user-images.githubusercontent.com/43658658/134437378-c64c528b-4b42-43b8-ba9e-c1f497eabd71.png)

VPC는 이후에 `VPC ID` 또는 `VPC 이름`으로 구분합니다.

> <h3>서브넷 생성</h3>

![image](https://user-images.githubusercontent.com/43658658/134437550-1ae32b03-83b4-4e18-b507-dcd36fc0b365.png)

[서브넷] > [서브넷 생성]을 클릭합니다.

![image](https://user-images.githubusercontent.com/43658658/134437770-d33a5f26-6aee-473a-b1fe-ba37e4c8794a.png)

앞서 생성한 `VPC`를 선택합니다.   
적절한 서브넷 이름을 입력하고, `IPv4`는 VPC 내부에 있어야 하므로 `10.m.0.0/16`으로 입력했다면 그대로 이어받아 3번째 숫자(`10.m.n.0/24`)를 정합니다.
[서브넷 생성] 버튼을 클릭합니다.

> <h3>인터넷 게이트웨이 생성</h3>

![image](https://user-images.githubusercontent.com/43658658/134437996-1d58d824-f0c6-412d-a401-6e9d9b5570db.png)

다음으로 인터넷 게이트웨이를 VPC에 달아줍시다.   
[인터넷 게이트웨이] > [인터넷 게이트웨이 생성]을 클릭합니다.

![image](https://user-images.githubusercontent.com/43658658/134438144-9225e3f6-b2b9-455b-913a-fc25e87c4a29.png)

적절한 `인터넷 게이트웨이 이름`을 설정해주고 [인터넷 게이트웨이 생성] 버튼을 눌러서 생성합니다.   

![image](https://user-images.githubusercontent.com/43658658/134438270-f10f392a-b795-4779-af11-390b8420fc58.png)

생성한 상태에서 우측 상단의 [작업] > [VPC 연결]을 클릭합니다.

![image](https://user-images.githubusercontent.com/43658658/134438319-069d6242-f4d4-4f79-9a7b-7c4e6aa8f4fa.png)

앞서 생성한 `VPC`를 선택하고 [인터넷 게이트웨이 연결] 버튼을 눌러서 `인터넷 게이트웨이`를 `VPC`에 달아줍니다.

> <h3>라우팅 테이블 연결</h3>

인터넷 게이트웨이를 생성하면 라우터 역시 자동으로 생성됩니다.
인터넷 게이트웨이를 VPC에 달아주었다면, `라우터`에서 인터넷 게이트웨이의 개방 범위를 설정해야 합니다.
왼쪽 탭의 [라우팅 테이블]을 클릭합니다.

![image](https://user-images.githubusercontent.com/43658658/134438538-430df0e9-1da7-4927-9ed0-3af33a02db6f.png)

앞서 연결한 VPC와 연결된 라우터를 찾아 클릭합니다.

![image](https://user-images.githubusercontent.com/43658658/134438667-8927bd12-6b52-4db5-9128-5b67f0c36d63.png)

[라우팅 편집] 버튼을 클릭합니다.

![image](https://user-images.githubusercontent.com/43658658/134438836-47e67323-dbb1-41be-bc69-b2af6af9718e.png)

`0.0.0.0/0`을 입력하여 모든 인터넷망에 대해서 개방합니다.   
인터넷 게이트웨이를 개방해야 하므로 대상은 `인터넷 게이트웨이`로 선택합니다.   
선택하면 앞서 생성한 인터넷 게이트웨이가 나타납니다. 그것을 클릭해줍니다.
[변경 사항 저장] 버튼을 누릅니다.

## EC2 웹서버 생성

> <h3>인스턴스(서버) 생성</h3>

EC2 서비스를 이용하여 인스턴스(서버)를 생성해 볼 것입니다.

![image](https://user-images.githubusercontent.com/43658658/134443595-1a5e39c5-b44d-4eb7-8dee-e41688955308.png)

상단의 검색창에 `EC2`를 검색합니다. 

![image](https://user-images.githubusercontent.com/43658658/134443660-be5aee35-1686-4a8c-a0b0-eaa37f44353e.png)

[인스턴스] > [인스턴스 시작]을 누릅니다.

  - 1단계 : AMI 선택
![image](https://user-images.githubusercontent.com/43658658/134443752-7585f43d-afbb-4377-a877-6ed7b01151db.png)   
  - 2단계 : 프리티어(t2.micro) 선택
![image](https://user-images.githubusercontent.com/43658658/134443825-41d1cc9a-5797-43b6-931a-593d066d0a4a.png)   
  - 3단계 : 인스턴스 구성
![image](https://user-images.githubusercontent.com/43658658/134443929-520d37a7-7c3e-439d-832a-023e3db6a828.png)   
인스턴스의 개수는 1개, VPC, 서브넷은 앞서 생성한 것으로 선택합니다.   
IP주소를 할당 받기 위해 `퍼블릭 IP 자동 할당`을 `활성화`로 선택합니다.   
종료 방식은 `중지`와 `종료`가 있는데, `중지`는 인스턴스 필요할 때 중지시켰다가 다시 재시작할 수 있습니다. `종료`는 인스턴스를 중지하면 바로 삭제됩니다.
  - 4단계 : 스토리지 추가
![image](https://user-images.githubusercontent.com/43658658/134444195-3364d076-b5e0-4a06-adfe-24bd6d0c2e67.png)   
스토리지 용량은 `30GB`까지 무료입니다. 스토리지 유형은 무난하게 `gp3`로 선택해주겠습니다.
  - 6단계 : 보안 그룹
![image](https://user-images.githubusercontent.com/43658658/134444541-a236a07b-9073-4221-a69c-df5ce520f964.png)   
새로운 보안그룹을 생성합니다. 적절한 이름을 입력해줍니다.   
포트는 22번, 80번을 개방합니다.   
22번은 터미널에서 들어오는 경로를 개방하는 것입니다. 보안을 위해 `내 IP`로 설정하여 나만 들어갈 수 있도록 설정합니다.
80번은 HTTP, 즉 인터넷을 통해 들어오는 경로를 개방하는 것입니다. 모든 사람이 접속할 수 있도록 `0.0.0.0/0`으로 설정합니다.   
  - 7단계 : 키페어 받기
![image](https://user-images.githubusercontent.com/43658658/134444787-440e4153-13f2-4237-befb-3e682095c9b7.png)   
키페어는 터미널에서 인스턴스로 접속할 때 반드시 필요로 하는 파일입니다.   
다운로드를 받으시고 [인스턴스 시작] 버튼을 눌러서 인스턴스를 생성합니다.

키페어 파일을 지우게 되면 복구가 불가능하고 영원히 인스턴스로 들어갈 수 없게 됩니다.   
![image](https://user-images.githubusercontent.com/43658658/134444992-dffc99f5-218a-410e-8d54-b7822b561eff.png)   
그렇기 때문에 보통 `C:` 경로에 `AWS`라는 폴더를 만들어 키페어 파일을 보관하곤 합니다.

> <h3>키페어 파일 변환 - PuTTy 사용</h3>

윈도우 OS에서 키페어 파일인 `.pem` 파일은 `.ppk`로 변환하지 않으면 사용할 수 없습니다.   
=> [PuTTy 다운 받기](https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html)   
![image](https://user-images.githubusercontent.com/43658658/134445451-9ac72c82-cd2f-4a51-97c7-63020987e6f8.png)   
위 사이트에 접속하여 PuTTy 설치 파일을 다운로드 받고, PuTTy를 설치합니다.

[Win] + [R] 단축키를 누르고 `puttygen`을 실행합니다.

![image](https://user-images.githubusercontent.com/43658658/134445963-1d539f9f-4619-444d-87dc-0387627ca453.png)

다운받은 키페어 파일을 선택합니다.   
키페어 파일이 있는 경로에서 `모든 파일` 보기로 변경해서 `.pem` 파일을 선택합니다.

![image](https://user-images.githubusercontent.com/43658658/134446046-41e26b44-7695-467d-a782-ec540247e1a4.png)

[save private key] 버튼을 눌러서 `.ppk` 파일을 만들어줍니다.

> <h3>EC2에 접속하기 - PuTTy 사용</h3>

[Win] + [R] 단축키를 누르고 `PuTTy`를 실행합니다.

![image](https://user-images.githubusercontent.com/43658658/134449242-c3357941-0570-49bf-8018-535272b13726.png)

왼쪽 탭에 [Connection] > [SSH] > [Auth] 로 들어가서 [Browse..] 버튼을 누릅니다.   
변환한 키페어 파일(`.ppk`)를 선택합니다.

![image](https://user-images.githubusercontent.com/43658658/134449652-8f615a34-0508-4b2f-a031-b5e1d9502875.png)

[Session]으로 들어가서 `Host name`에 인스턴스의 퍼블릭 IP 주소를 입력합니다.

![image](https://user-images.githubusercontent.com/43658658/134449579-ad260947-4cd0-447a-9c8b-8fc7a775d6b1.png)

인스턴스의 `퍼블릭 IP 주소`는 이곳에 표시되어 있습니다.

이제 [Open] 버튼을 누릅니다.   
이때 나타나는 알림창은 `예`를 누르시면, 터미널 창이 나타나고 login as : 라고 떠있는 것을 확인할 수 있습니다.   

![image](https://user-images.githubusercontent.com/43658658/134449943-2a7a93ba-6f2a-442e-9abc-5090eafb1164.png)

인스턴스 생성 당시 OS를 Linux로 했다면 `ec2-user`를 입력해야합니다.   
(처음 연결할 때는 확인메세지가 나오는데 `yes`를 입력하시고 엔터를 누르시면 됩니다)

이제 서버에 접속을 완료하였습니다.

> <h3>Apache 설치 - 웹서버로 변경</h3>

Apache를 설치하여 인스턴스(서버)를 웹서버로 만들어보겠습니다.

```
sudo yum install httpd -y
```

![image](https://user-images.githubusercontent.com/43658658/134450228-f7cbeb95-a9e4-400e-bb3d-88a69eddea05.png)

위의 명령어를 입력해서 아파치(httpd)를 설치합니다.

```
sudo service httpd start
```

아파치를 실행시키겠습니다.

```
sudo chkconfig httpd on
```

![image](https://user-images.githubusercontent.com/43658658/134450550-3df03dce-be85-4b21-878a-99e1f3eb791c.png)

웹서버를 재시작할 시 제일 먼저 아파치가 실행되도록 설정하는 명령어입니다.   
실제 상황에서 웹서버를 중단시켰다가 다시 실행할 때 제일 먼저 아파치가 실행되어야 장애를 조금이라도 줄일 수 있습니다.   
아파치를 설치했다면 습관처럼 설정해주셔야 합니다.

![image](https://user-images.githubusercontent.com/43658658/134450743-feb88159-9678-444f-9f56-685ec7824613.png)

웹 브라우저의 URL 창에 `http://퍼블릭IP주소:80`으로 접속하면 위와 같은 페이지가 뜹니다.   
페이지가 정상적으로 뜬다면 웹서버가 정상적으로 생성되었다는 뜻입니다.

